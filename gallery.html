<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>P5.js Workshop Gallery</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="gallery-container">
      <div id="sketch-container"></div>
      <div class="controls-overlay">
        <div class="nav-buttons">
          <button id="prev-btn" onclick="previousSketch()">←</button>
          <button id="next-btn" onclick="nextSketch()">→</button>
        </div>
        <div class="sketch-info">
          <span id="sketch-counter"></span>
          <span id="sketch-author"></span>
        </div>
        <div>
          <a href="upload.html" class="btn-link">Upload</a>
          <a href="index.html" class="btn-link">Home</a>
        </div>
      </div>
    </div>

    <script>
      let sketches = [];
      let currentIndex = 0;

      // Load manifest and initialize gallery
      async function loadGallery() {
        try {
          const response = await fetch('sketches/manifest.json', {
            cache: 'no-cache',
          });
          const data = await response.json();
          sketches = data.sketches || [];

          if (sketches.length === 0) {
            showEmptyState();
          } else {
            loadSketch(0);
          }
        } catch (error) {
          console.error('Error loading manifest:', error);
          showEmptyState();
        }
      }

      // Show empty state when no sketches
      function showEmptyState() {
        const container = document.getElementById('sketch-container');
        container.innerHTML = `
        <div class="empty-state">
          <h2>No sketches yet</h2>
          <p>Be the first to <a href="upload.html">upload a sketch</a>!</p>
        </div>
      `;
        document.getElementById('prev-btn').disabled = true;
        document.getElementById('next-btn').disabled = true;
        document.getElementById('sketch-counter').textContent = '';
        document.getElementById('sketch-author').textContent = 'No sketches yet';
      }

      // Load a specific sketch by index
      function loadSketch(index) {
        if (index < 0 || index >= sketches.length) return;

        currentIndex = index;
        const sketch = sketches[index];
        const container = document.getElementById('sketch-container');

        // Create iframe pointing to the sketch viewer
        container.innerHTML = `<iframe 
          src="sketch-viewer.html?sketch=${encodeURIComponent(sketch.filename)}" 
          style="width: 100%; height: 100%; border: none;"
          sandbox="allow-scripts"
        ></iframe>`;

        // Update UI
        updateControls();
      }

      // Update control buttons and info
      function updateControls() {
        const sketch = sketches[currentIndex];

        // Update counter
        document.getElementById('sketch-counter').textContent = `Sketch ${currentIndex + 1} of ${sketches.length}`;

        // Update author
        document.getElementById('sketch-author').textContent = `by ${sketch.author}`;

        // Update button states
        document.getElementById('prev-btn').disabled = currentIndex === 0;
        document.getElementById('next-btn').disabled = currentIndex === sketches.length - 1;
      }

      // Navigation functions
      function previousSketch() {
        if (currentIndex > 0) {
          loadSketch(currentIndex - 1);
        }
      }

      function nextSketch() {
        if (currentIndex < sketches.length - 1) {
          loadSketch(currentIndex + 1);
        }
      }

      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
          previousSketch();
        } else if (e.key === 'ArrowRight') {
          nextSketch();
        }
      });

      // Initialize on load
      loadGallery();
    </script>
  </body>
</html>
